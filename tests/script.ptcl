unsyntax {
	prototype function printf(content: character*, ...): integer
	prototype function printn(content: integer, ...): integer
	prototype function printc(content: character, ...): integer
	prototype function strlen(content: character*): integer
	prototype function malloc(size: integer): pointer
}

syntax list_name([T: static type]) {
	!<__list_ word(T)>
}

syntax list_object_name([T: static type]) {
	!<__list_object_ word(T)>
}

syntax list([T: any]) {
	you_forgot_about_type
}

syntax list([T: static type]) {
	@{
		~type_name: static word = #list_name(T)
		~type_object_name: static word = #list_object_name(T)
		global typedata !~type_object_name(entities: !T*, length: integer, capacity: integer)
		global type !~type_name: !~type_object_name {
			function add(entity: !T): void {
				self.entities[self.length] = entity
				self.length = self.length + 1
			}

			function at(index: integer): !T {
				return self.entities[index]
			}
		}

		syntax [left: !~type_name][[index: integer]] {
			left.at(index)
		}
	}

	!~type_name
}

syntax list([T: static type])([capacity: integer]) {
	#list_object_name(T)(null, 0, capacity) :: #list_name(T)
}

syntax list([T: static type])() {
	#list(T)(0)
}

syntax using([name: static word]=[value: any]) [body: static (): void] {
	!name := value
}

syntax class_typedata_name([name: static word]) {
	!<__class_ !name>
}

syntax class [name: static word] [body: static (): void] {
	~name: static word = #class_typedata_name(name)
	global typedata !~name()
	global type !name : !~name {
		ptcl_insert(ptcl_get_statements(body))
	}
}

syntax new [name: static word]() {
	@{
		~instance := #class_typedata_name(name)() :: !name
		~instance.constructor()
	}

	~instance
}

syntax object_name [name: static word] {
	!<__object_ !name>
}

syntax object [name: static word] [variables: ...] with [body: static (): void] {
	~typedata_name: static word = #object_name(name)
	typedata !~typedata_name(ptcl_insert(variables))
	type !name: !~typedata_name {
		ptcl_insert(ptcl_get_statements(body))
	}
}

syntax new [name: static word]([arguments: ...]) {
	#object_name(name)(ptcl_insert(arguments))
}

function main(): integer {
	#object dog 
		name: character*,
		years: integer 
	with {
		function speak(): void {
			printf(self.name)
		}
	}

	instance := #new dog("Tom", 12)
	return 0
}